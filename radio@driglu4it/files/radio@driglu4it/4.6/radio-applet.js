var radioApplet;(()=>{"use strict";var t={d:(n,e)=>{for(var o in e)t.o(e,o)&&!t.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:e[o]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};t.r(n),t.d(n,{main:()=>on});const{AppletSettings:e}=imports.ui.settings;class o{constructor(t){this.channelList=t}set channelList(t){const n=t.filter((t=>t.inc));this._channelList=n.map((t=>Object.assign(Object.assign({},t),{url:t.url.trim()})))}get activatedChannelUrls(){return this._channelList.map((t=>t.url))}get activatedChannelNames(){return this._channelList.map((t=>t.name))}getChannelName(t){const n=this._channelList.find((n=>n.url===t));return n?n.name:null}getChannelUrl(t){const n=this._channelList.find((n=>n.name===t));return n?n.url:null}checkListChanged(t){return JSON.stringify(t)!==JSON.stringify(this._channelList)}checkUrlValid(t){return this._channelList.some((n=>n.url===t))}}const{KEY_space:i,KEY_KP_Enter:a,KEY_Return:l}=imports.gi.Clutter;function c(t){const{widget:n,onActivated:e}=t;n.can_focus=!0,n.reactive=!0,n.track_hover=!0,n.connect("button-release-event",(()=>null==e?void 0:e())),n.connect("notify::hover",(()=>{n.change_style_pseudo_class("active",n.hover),n.hover&&n.grab_key_focus()})),n.connect("key-press-event",((t,o)=>{const c=o.get_key_symbol();[i,a,l].includes(c)&&n.hover&&(null==e||e())}))}const{BoxLayout:r,Label:s,Icon:u,ScrollView:d}=imports.gi.St,{ActorAlign:p,Point:m}=imports.gi.Clutter,{PolicyType:g}=imports.gi.Gtk;const{get_home_dir:h}=imports.gi.GLib,_=`${h()}/.cinnamon/configs/${__meta.uuid}/.mpris.so`,f="org.mpris.MediaPlayer2.Player",y="org.mpris.MediaPlayer2.mpv",v="popup-menu-item",b="radioapplet",w="media-playback-start",C="media-playback-pause",S="view-refresh-symbolic",{Icon:P,IconType:x,Label:k,BoxLayout:L}=imports.gi.St;function M(t){const{text:n,maxCharNumber:e,iconName:o,onActivated:i}=t;let a,l;const r=new L({style_class:"popup-menu-item"});function s(t){if(a&&!t)return r.remove_child(a),void(a=null);t&&(a||(a=new P({icon_type:x.SYMBOLIC,style_class:"popup-menu-icon"})),a.icon_name=t,r.get_child_at_index(0)!==a&&r.insert_child_at_index(a,0))}function u(t){const n=t||" ";l||(l=new k,r.add_child(l)),l.set_text(function(t,n){if(t)return t.length<=n?t:[...t].slice(0,n-3).join("")+"..."}(n,e))}return s(o),u(n),i&&c({widget:r,onActivated:i}),{actor:r,setIconName:s,setText:u}}function I(t){const{stationNames:n,onChannelClicked:e}=t,o=function(t){const{text:n}=t,e=new r({vertical:!0}),o=new s({text:n}),i=new u({style_class:"popup-menu-arrow",icon_name:"pan-end",rotation_angle_z:90,x_expand:!0,x_align:p.END,pivot_point:new m({x:.5,y:.5}),important:!0}),a=new r({style_class:"popup-menu-item popup-submenu-menu-item"});c({widget:a,onActivated:function(){l.visible?(l.hide(),i.rotation_angle_z=0):(l.show(),i.rotation_angle_z=90)}}),[o,i].forEach((t=>a.add_child(t))),e.add_child(a);const l=new d({style_class:"popup-sub-menu",vscrollbar_policy:g.AUTOMATIC,hscrollbar_policy:g.NEVER}),h=new r({vertical:!0});return l.add_actor(h),[a,l].forEach((t=>e.add_child(t))),{actor:e,box:h}}({text:"My Stations"});let i,a="Stopped";const l=new Map;function h(t){l.clear(),o.box.remove_all_children(),t.forEach((t=>{const n=function(t){const{channelName:n,onActivated:e,playbackStatus:o}=t,i=new Map([["Playing",w],["Paused",C],["Loading",S],["Stopped",null]]),a=M({maxCharNumber:40,text:n,onActivated:()=>e(n)});function l(t){const n=i.get(t);a.setIconName(n)}return o&&l(o),{setPlaybackStatus:l,actor:a.actor}}({channelName:t,onActivated:e,playbackStatus:t===i?a:"Stopped"});l.set(t,n),o.box.add_child(n.actor)}))}return h(n),{actor:o.actor,setPlaybackStatus:function(t){if(a=t,!i)return;const n=l.get(i);null==n||n.setPlaybackStatus(a),"Stopped"===a&&(i=null)},setStationNames:h,setCurrentChannel:function(t){const n=l.get(i);if(null==n||n.setPlaybackStatus("Stopped"),t){const n=l.get(t);if(!n)throw new Error(`No channelItem exist for ${t}`);n.setPlaybackStatus(a)}i=t}}}const{getDBusProperties:T,getDBus:V,getDBusProxyWithOwner:O}=imports.misc.interfaces,{spawnCommandLine:A}=imports.misc.util,{MixerControl:B}=imports.gi.Cvc;const{DrawingArea:N}=imports.gi.St,{cairo_set_source_color:E,grab_pointer:D,ungrab_pointer:U}=imports.gi.Clutter;function $(t){const{initialValue:n,onValueChanged:e}=t;let o;n&&(o=l(n));const i=new N({style_class:"popup-slider-menu-item",reactive:!0,x_expand:!0});function a(t){const[n,e]=t.get_coords(),[o,a]=i.get_transformed_position(),r=n-o,s=i.width,u=i.get_theme_node().get_length("-slider-handle-radius");c(l((r-u)/(s-2*u)))}function l(t){return Math.max(Math.min(t,1),0)}function c(t,n=!1){const a=l(t);a!==o&&(o=a,n||null==e||e(o),i.queue_repaint())}return i.connect("repaint",(()=>{const t=i.get_context(),n=i.get_theme_node(),[e,a]=i.get_surface_size(),l=n.get_length("-slider-handle-radius"),c=n.get_length("-slider-height"),r=n.get_length("-slider-border-width"),s=Math.min(e,c)/2,u=n.get_color("-slider-border-color"),d=n.get_color("-slider-background-color"),p=n.get_color("-slider-active-border-color"),m=n.get_color("-slider-active-background-color"),g=2*Math.PI,h=l+(e-2*l)*o;t.arc(s+r,a/2,s,1*g/4,3*g/4),t.lineTo(h,(a-c)/2),t.lineTo(h,(a+c)/2),t.lineTo(s+r,(a+c)/2),E(t,m),t.fillPreserve(),E(t,p),t.setLineWidth(r),t.stroke(),t.arc(e-s-r,a/2,s,3*g/4,1*g/4),t.lineTo(h,(a+c)/2),t.lineTo(h,(a-c)/2),t.lineTo(e-s-r,(a-c)/2),E(t,d),t.fillPreserve(),E(t,u),t.setLineWidth(r),t.stroke();const _=a/2,f=n.get_foreground_color();E(t,f),t.arc(h,_,l,0,2*Math.PI),t.fill(),t.$dispose()})),i.connect("button-press-event",((t,n)=>{D(i);const e=i.connect("motion-event",((t,n)=>{a(n)})),o=i.connect("button-release-event",(()=>{i.disconnect(o),i.disconnect(e),U()}));a(n)})),{actor:i,setValue:c,getValue:function(){return o}}}const{BoxLayout:R,Icon:z,IconType:Y}=imports.gi.St,{Tooltip:j}=imports.ui.tooltips,{KEY_Right:G,KEY_Left:W,ScrollDirection:F}=imports.gi.Clutter;function K(t){const{onVolumeChanged:n}=t;let e;const o=new R({style_class:v});let i;c({widget:o});const a=$({onValueChanged:function(t){s(100*t,!0)}}),l=new z({icon_type:Y.SYMBOLIC,style_class:"popup-menu-icon",reactive:!0});function r(t){const n="increase"===t?5:-5,e=a.getValue()+n/100;a.setValue(e)}function s(t,o){const c=Math.round(t);c!==i&&(i=c,a.setValue(i/100),l.set_icon_name(function(t){const{volume:n}=t,e=[{max:0,name:"audio-volume-muted"},{max:33,name:"audio-volume-low"},{max:66,name:"audio-volume-medium"},{max:100,name:"audio-volume-high"}];if(n<0||n>100)throw new RangeError("volume should be between 0 and 100");const o=e.findIndex((t=>{var{max:e}=t;return function(t,n){var e={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&n.indexOf(o)<0&&(e[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(t);i<o.length;i++)n.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(t,o[i])&&(e[o[i]]=t[o[i]])}}(t,["max"]),n<=e}));return e[o].name}({volume:i})),function(t){e||(e=new j(a.actor," ")),e.set_text(`Volume: ${t.toString()} %`)}(i),o&&e.show(),null==n||n(i))}return[l,a.actor].forEach((t=>{o.add_child(t)})),o.connect("key-press-event",((t,n)=>{const e=n.get_key_symbol();e!==G&&e!==W||r(e===G?"increase":"decrease")})),o.connect("scroll-event",((t,n)=>{r(n.get_scroll_direction()===F.UP?"increase":"decrease")})),l.connect("button-press-event",(()=>{a.setValue(0)})),{actor:o,setVolume:function(t){s(t,!1)}}}const{BoxLayout:H,Bin:q,Side:J}=imports.gi.St,{uiGroup:Z,layoutManager:Q,panelManager:X,pushModal:tt,popModal:nt}=imports.ui.main,{KEY_Escape:et}=imports.gi.Clutter,{util_get_transformed_allocation:ot}=imports.gi.Cinnamon,{PanelLoc:it}=imports.ui.popupMenu;const{BoxLayout:at,DrawingArea:lt}=imports.gi.St,{LinearGradient:ct}=imports.gi.cairo,{BoxLayout:rt}=imports.gi.St,{ActorAlign:st}=imports.gi.Clutter,{Button:ut,Icon:dt,IconType:pt}=imports.gi.St,{Tooltip:mt}=imports.ui.tooltips;function gt(t){const{iconName:n,tooltipTxt:e,onClick:o}=t,i=new dt({icon_type:pt.SYMBOLIC,icon_name:n,style_class:"popup-menu-icon"}),a=new ut({reactive:!0,can_focus:!0,style_class:"popup-menu-item",style:"width:20px; padding:10px!important",child:i});return c({widget:a,onActivated:o}),{actor:a,icon:i,tooltip:new mt(a,e)}}const{BoxLayout:ht}=imports.gi.St,{spawnCommandLineAsyncIO:_t}=imports.misc.util,{get_home_dir:ft}=imports.gi.GLib,{spawnCommandLineAsyncIO:yt}=imports.misc.util,vt=function(t){return new Promise(((n,e)=>{yt(t,((t,e,o)=>{n(t?[null,t,0]:[e,null,o])}))}))},{SystemNotificationSource:bt,Notification:wt}=imports.ui.messageTray,{messageTray:Ct}=imports.ui.main,{Icon:St,IconType:Pt}=imports.gi.St,xt=new bt("Radio Applet");function kt(t){const{notificationText:n,isMarkup:e=!1,transient:o=!0}=t,i=new St({icon_type:Pt.SYMBOLIC,icon_name:b,icon_size:25}),a=new wt(xt,__meta.name,n,{icon:i,bodyMarkup:e});return a.setTransient(o),a.notify=()=>{xt.notify(a)},a}function Lt(t){const{text:n}=t;kt({notificationText:n}).notify()}Ct.add(xt);const{find_program_in_path:Mt,file_test:It,FileTest:Tt}=imports.gi.GLib;function Vt(){return Mt("mpv")}function Ot(){return It(_,Tt.IS_REGULAR)}const{Clipboard:At,ClipboardType:Bt}=imports.gi.St,{Applet:Nt,AllowedLayout:Et}=imports.ui.applet,{Bin:Dt}=imports.gi.St,{EventType:Ut}=imports.gi.Clutter,{Icon:$t,IconType:Rt}=imports.gi.St,{IconType:zt}=imports.gi.St,{Label:Yt}=imports.gi.St,{EllipsizeMode:jt}=imports.gi.Pango,{ActorAlign:Gt}=imports.gi.Clutter,{PanelItemTooltip:Wt}=imports.ui.tooltips,{spawnCommandLine:Ft}=imports.misc.util,{spawnCommandLine:Kt}=imports.misc.util,{get_home_dir:Ht}=imports.gi.GLib;function qt(){const t=kt({notificationText:"Couldn't download Song from Youtube due to an Error. Make Sure you have the newest version of youtube-dl installed. \n        \n<b>Important:</b> Don't use apt for the installation but follow the installation instruction given on the Radio Applet Site in the Cinnamon Store instead\n        \nFor more information see the logs",isMarkup:!0,transient:!1}),n="viewStoreBtn",e="viewLogBtn";t.addButton(n,"View Installation Instruction"),t.addButton(e,"View Logs"),t.connect("action-invoked",((t,o)=>{o===n&&Kt("xdg-open https://cinnamon-spices.linuxmint.com/applets/view/297 "),o===e&&Kt(`xdg-open ${Ht()}/.xsession-errors`)})),t.notify()}const{BoxLayout:Jt,Label:Zt}=imports.gi.St,{ScrollDirection:Qt}=imports.gi.Clutter,{getAppletDefinition:Xt}=imports.ui.appletManager,{panelManager:tn}=imports.ui.main,{IconType:nn,BoxLayout:en}=imports.gi.St;function on(t){const{orientation:n,panelHeight:i,instanceId:a}=t;let l,r,s=!1;const u=Xt({applet_id:a}),d=tn.panels.find((t=>(null==t?void 0:t.panelId)===u.panelId));d.connect("icon-size-changed",(()=>p.updateIconSize()));const p=function(t){const{panel:n,locationLabel:e}=t;let o;const i=new Map([["Stopped"," "],["Loading"," "]]),a=new $t({});let l;function c(t,o){a.style_class=t===zt.SYMBOLIC?"system-status-icon":"applet-icon",a.icon_name=o,a.icon_type=t,a.icon_size=n.getPanelZoneIconSize(e,t)}function r(t){if(!t)return;let n,e;l=t,"SYMBOLIC"===t?(e=b,n=zt.SYMBOLIC):(e=`radioapplet-${t.toLowerCase()}`,n=zt.FULLCOLOR),c(n,e)}function s(t){o=t;const n=i.get(o);"Loading"===t?c(zt.SYMBOLIC,S):r(l),n&&a.set_style(n)}return{actor:a,setPlaybackStatus:s,setColorWhenPlaying:function(t){i.set("Playing",`color: ${t}`),o&&s(o)},setColorWhenPaused:function(t){i.set("Paused",`color: ${t}`),o&&s(o)},setIconType:r,updateIconSize:function(){const t=n.getPanelZoneIconSize(e,a.icon_type);a.icon_size=t}}}({locationLabel:u.location_label,panel:d}),m=function(){const t=new Yt({reactive:!0,track_hover:!0,style_class:"applet-label",y_align:Gt.CENTER,y_expand:!1,visible:!1});let n,e;function o(o){e=o,n&&(t.show(),o?t.text=` ${o}`:t.hide())}return t.clutter_text.ellipsize=jt.NONE,{actor:t,setVisibility:function(i){n=i,e&&(t.visible=i),n&&e&&o(e)},setText:o}}(),g=function(t){const{orientation:n,panelHeight:e,instanceId:o,icon:i,label:a,onClick:l,onScroll:c,onMiddleClick:r,onAppletMoved:s,onAppletRemoved:u,onRightClick:d}=t,p=new Nt(n,e,o);let m=!1;return[i,a].forEach((t=>{p.actor.add_child(t)})),p.on_applet_clicked=l,p.on_applet_middle_clicked=r,p.setAllowedLayout(Et.BOTH),p.on_applet_reloaded=function(){m=!0},p.on_applet_removed_from_panel=function(){m?s():u(),m=!1},p.actor.connect("event",((t,n)=>{n.type()===Ut.BUTTON_PRESS&&3===n.get_button()&&d()})),p.actor.connect("scroll-event",((t,n)=>{c(n.get_scroll_direction())})),p}({icon:p.actor,label:m.actor,instanceId:a,orientation:n,panelHeight:i,onClick:async function(){if(!s)try{s=!0,await async function(){const t=Ot(),n=Vt();!t&&await new Promise((async(t,n)=>{if(Ot())return t();let[e,o,i]=await vt(`python3  ${__meta.path}/download-dialog-mpris.py`);return"Continue"!==o.trim()?n():([e,o,i]=await vt(`\n            wget https://github.com/hoyon/mpv-mpris/releases/download/0.5/mpris.so -O ${_}`),0===i?t():n(e))})),n||(Lt({text:`Please ${t?"":"also"} install the mpv package.`}),await new Promise((async(t,n)=>{if(Vt())return t();if(!Mt("apturl"))return n();const[e,o,i]=await vt("\n            apturl apt://mpv");return 0===i?t():n(e)})))}(),N.toggle()}catch(t){Lt({text:"Couldn't start the applet. Make sure mpv is installed and the mpv mpris plugin saved in the configs folder."}),global.logError(t)}finally{s=!1}},onScroll:function(t){const n=t===Qt.UP?5:-5;r.increaseDecreaseVolume(n)},onMiddleClick:()=>null==r?void 0:r.togglePlayPause(),onAppletMoved:()=>null==r?void 0:r.deactivateAllListener(),onAppletRemoved:function(){null==r||r.deactivateAllListener(),null==r||r.stop()},onRightClick:()=>null==N?void 0:N.close()}),h=function(t){const{orientation:n,applet:e}=t,o=new Wt(e,null,n);return{setVolume:function(t){null!=t?o.set_text(`Volume: ${t.toString()} %`):o.set_text("Radio++")}}}({applet:g,orientation:n}),P=(t=>{const{uuid:n,instanceId:o,onIconChanged:i,onIconColorPlayingChanged:a,onIconColorPausedChanged:l,onChannelOnPanelChanged:c,onMyStationsChanged:r}=t,s={get initialVolume(){return function(){const{keepVolume:t,lastVolume:n,customInitVolume:e}=s;let o=t?n:e;return null==o&&(global.logWarning("initial Volume was null or undefined. Applying 50 as a fallback solution to prevent radio stop working"),o=50),o}()}},u=new e(s,n,o);return u.bind("icon-type","iconType",(t=>i(t))),u.bind("color-on","symbolicIconColorWhenPlaying",(t=>a(t))),u.bind("color-paused","symbolicIconColorWhenPaused",(t=>l(t))),u.bind("channel-on-panel","channelNameOnPanel",(t=>c(t))),u.bind("keep-volume-between-sessions","keepVolume"),u.bind("initial-volume","customInitVolume"),u.bind("last-volume","lastVolume"),u.bind("tree","userStations",r),u.bind("last-url","lastUrl"),u.bind("music-download-dir-select","musicDownloadDir",(()=>{null===s.musicDownloadDir&&(s.musicDownloadDir="~/Music/Radio")})),i(s.iconType),a(s.symbolicIconColorWhenPlaying),l(s.symbolicIconColorWhenPaused),c(s.channelNameOnPanel),s})({uuid:__meta.uuid,instanceId:a,onIconChanged:function(t){p.setIconType(t)},onIconColorPlayingChanged:t=>{p.setColorWhenPlaying(t)},onIconColorPausedChanged:t=>{p.setColorWhenPaused(t)},onChannelOnPanelChanged:t=>{m.setVisibility(t)},onMyStationsChanged:function(t){x.checkListChanged(t)&&(x.channelList=t,k.setStationNames(x.activatedChannelNames),x.checkUrlValid(P.lastUrl)||r.stop())}}),x=new o(P.userStations),k=I({stationNames:x.activatedChannelNames,onChannelClicked:function(t){const n=x.getChannelUrl(t);r.setUrl(n)}}),L=K({onVolumeChanged:t=>null==r?void 0:r.setVolume(t)}),N=function(t){const{launcher:n}=t,e=new H({style_class:"popup-menu-content",vertical:!0,visible:!1}),o=new q({style_class:"menu",child:e,visible:!1});function i(){const t=function(){var t,e,o,i;const a=Q.findMonitorForActor(n),l=X.getPanelsInMonitor(a.index),c=new Map(l.map((t=>{let n=0,e=0;return t.getIsVisible()&&(n=t.actor.width,e=t.actor.height),[t.panelPosition,{width:n,height:e}]})));return{left:a.x+((null===(t=c.get(it.left))||void 0===t?void 0:t.width)||0),bottom:a.y+a.height-((null===(e=c.get(it.bottom))||void 0===e?void 0:e.height)||0),top:a.y+((null===(o=c.get(it.top))||void 0===o?void 0:o.height)||0),right:a.x+a.width-((null===(i=c.get(it.right))||void 0===i?void 0:i.width)||0)}}(),i=function(t){const n=(t.bottom-t.top)/global.ui_scale,i=e.get_theme_node(),a=o.get_theme_node(),l=i.get_padding(J.TOP);return n-i.get_padding(J.BOTTOM)-l-a.get_border_width(J.TOP)-a.get_border_width(J.BOTTOM)}(t);e.style=`max-height: ${i}px;`;const[a,l]=function(t,o){const i=ot(n),[a,l,c,r]=e.get_preferred_size(),s=(c-i.get_width())/2,u=Math.max(o.left,i.x1-s),d=i.x2+s,p=o.right-i.get_width()-2*s,m=d<o.right?u:p,g=Math.max(i.y1,o.top),h=g+r,_=o.bottom-e.height;return[m,h<o.bottom?g:_]}(0,t);o.set_position(Math.floor(a),Math.floor(l))}function a(){e.visible&&(o.hide(),e.hide(),n.remove_style_pseudo_class("checked"),nt(e))}function l(t,o){if(!e.visible)return;const i=o.get_source(),l=e.contains(i),c=n.contains(i);!l&&!c&&a()}return Z.add_child(o),e.connect("key-press-event",((t,n)=>{n.get_key_symbol()===et&&a()})),n.connect("queue-relayout",(()=>{e.visible&&setTimeout((()=>{i()}),0)})),e.toggle=function(){e.visible?a():(i(),o.show(),e.show(),n.add_style_pseudo_class("checked"),tt(e),global.stage.connect("button-press-event",l),global.stage.connect("button-release-event",l))},e.close=a,e}({launcher:g.actor}),E=function(){const t=o(b),n=o("audio-x-generic"),e=new ht({vertical:!0});function o(t){return M({iconName:t,maxCharNumber:40})}return[t,n].forEach((t=>{e.add_child(t.actor)})),{actor:e,setSongTitle:function(t){n.setText(t)},setChannel:function(n){t.setText(n)}}}(),D=function(t){const{onClick:n}=t,e=gt({iconName:w,tooltipTxt:"Play",onClick:n});return{actor:e.actor,setPlaybackStatus:function(t){let n,o;"Playing"===t&&(n="Pause",o=C),"Paused"===t&&(n="Play",o=w),e.tooltip.set_text(n),e.icon.icon_name=o}}}({onClick:()=>r.togglePlayPause()}),U=function(t){const{onClick:n}=t;return{actor:gt({iconName:"media-playback-stop",tooltipTxt:"Stop",onClick:n}).actor}}({onClick:()=>r.stop()}),R=function(t){const{onClick:n}=t;return{actor:gt({iconName:"south-arrow-weather-symbolic",tooltipTxt:"Download current song from Youtube",onClick:n}).actor}}({onClick:function(){const t=r.getCurrentTitle(),n=function(t){const{title:n,downloadDir:e,onDownloadFinished:o,onDownloadFailed:i}=t;let a=!1;const l=`\n        youtube-dl --output "${e.replace("~",ft()).replace("file://","")}/%(title)s.%(ext)s" --extract-audio --audio-format mp3 ytsearch1:"${n.replace('"','"')}" --add-metadata --embed-thumbnail`,c=_t(l,((t,n)=>{try{if(a)return void(a=!1);if(n)throw new Error(n);if(t){const n=function(t){const n=t.match(/[^\r\n]+/g),e="[ffmpeg] Destination: ";return n.find((t=>t.includes(e))).split(e)[1]}(t);if(!n)throw new Error("File not saved");o(n)}}catch(t){global.logError(`The following error occured at youtube download attempt: ${t}. The used download Command was: ${l}`),i()}}));return{cancel:function(){a=!0,c.force_exit()}}}({downloadDir:P.musicDownloadDir,title:t,onDownloadFinished:t=>function(t){const{downloadPath:n}=t,e=kt({notificationText:`Download finished. File saved to ${n}`}),o="openBtn";e.addButton(o,"Play"),e.connect("action-invoked",((t,e)=>{e===o&&Ft(`xdg-open '${n}'`)})),e.notify()}({downloadPath:t}),onDownloadFailed:qt});!function(t){const{title:n,onCancelClicked:e}=t,o=kt({notificationText:`Downloading ${n} ...`}),i="cancelBtn";o.addButton(i,"Cancel"),o.connect("action-invoked",((t,n)=>{n===i&&e()})),o.notify()}({title:t,onCancelClicked:()=>n.cancel()})}}),z=function(t){const{onClick:n}=t,e=gt({iconName:"edit-copy",tooltipTxt:"Copy current song title to Clipboard",onClick:function(){e.tooltip.show(),n()}});return{actor:e.actor}}({onClick:()=>{return t=r.getCurrentTitle(),void At.get_default().set_text(Bt.CLIPBOARD,t);var t}}),Y=(t=>{const{controlBtns:n}=t,e=new rt({style_class:"radio-applet-media-control-toolbar",x_align:st.CENTER});return n.forEach((t=>e.add_child(t))),e})({controlBtns:[D.actor,R.actor,z.actor,U.actor]}),j=function(t){const{onPositionChanged:n}=t,e=new Jt({style_class:v});c({widget:e});let o,i=100;const a=new Zt,l=new Zt,r=$({initialValue:.5,onValueChanged:function(t){n(t*i)}});function s(){const t=0===i?0:Math.min(o/i,1);r.setValue(t,!0)}function u(t){const n=Math.floor(t/60);return[n,t-60*n].map((t=>t.toString().padStart(2,"0"))).join(":")}return[a,r.actor,l].forEach((t=>{e.add_child(t)})),{actor:e,setLength:function(t){i=t,l.set_text(u(t)),s()},setPosition:function(t){o=t,a.set_text(u(o)),s()}}}({onPositionChanged:t=>null==r?void 0:r.setPosition(t)}),G=new en({vertical:!0,visible:!1});function W(t){L.setVolume(t),h.setVolume(t),l=t}return[E.actor,Y,L.actor,j.actor].forEach((t=>{G.add_child(function(){const t=new at({style_class:"popup-menu-item"}),n=new lt({style_class:"popup-separator-menu-item",x_expand:!0});return t.add_child(n),n.connect("repaint",(()=>{const t=n.get_context(),e=n.get_theme_node(),[o,i]=n.get_surface_size(),a=e.get_length("-margin-horizontal"),l=e.get_length("-gradient-height"),c=e.get_color("-gradient-start"),r=e.get_color("-gradient-end"),s=o-2*a,u=(i-l)/2,d=new ct(a,u,o-a,u+l);d.addColorStopRGBA(0,c.red/255,c.green/255,c.blue/255,c.alpha/255),d.addColorStopRGBA(.5,r.red/255,r.green/255,r.blue/255,r.alpha/255),d.addColorStopRGBA(1,c.red/255,c.green/255,c.blue/255,c.alpha/255),t.setSource(d),t.rectangle(a,u,s,l),t.fill(),t.$dispose})),t}()),G.add_child(t)})),N.add_child(k.actor),N.add_child(G),r=function(t){const{onPlaybackstatusChanged:n,onUrlChanged:e,onVolumeChanged:o,onTitleChanged:i,onLengthChanged:a,onPositionChanged:l,checkUrlValid:c,lastUrl:r,getInitialVolume:s}=t,u=V(),d=O(f,y),p=T(y,"/org/mpris/MediaPlayer2"),m=new B({name:__meta.name});let g;m.open(),m.connect("stream-added",((t,n)=>{const e=m.lookup_stream_id(n);"mpv Media Player"===(null==e?void 0:e.name)&&(g=e,g.connect("notify::volume",(()=>{R(Math.round(g.volume/m.get_vol_max_norm()*100))})))}));const h=r?Y():"Stopped";let v="Stopped"!==h?r:null,b=G((null===(C=null===(w=d.Metadata)||void 0===w?void 0:w["mpris:length"])||void 0===C?void 0:C.unpack())||0);var w,C;let S,P,x,k=!1;"Stopped"!==h&&(M(),I(),e(v),n(h),o(j()),i(z()),a(b),l($()),D());const L=u.connectSignal("NameOwnerChanged",((...t)=>{const e=t[2][0],o=t[2][1],i=t[2][2];e===y&&(i&&(M(),I(),u.ListNamesSync()[0].forEach((t=>{t.includes("org.mpris.MediaPlayer2")&&t!==y&&O(f,t).PauseSync()}))),o&&(b=0,U(),p.disconnectSignal(P),d.disconnectSignal(x),P=x=v=null,n("Stopped")))}));function M(){P=p.connectSignal("PropertiesChanged",((t,a,[r,s])=>{var u,p,h,_,f,y;const w=null===(u=s.Metadata)||void 0===u?void 0:u.deep_unpack(),C=null===(p=s.Volume)||void 0===p?void 0:p.unpack(),P=null===(h=s.PlaybackStatus)||void 0===h?void 0:h.unpack(),x=null===(_=null==w?void 0:w["xesam:url"])||void 0===_?void 0:_.unpack(),k=null===(f=null==w?void 0:w["xesam:title"])||void 0===f?void 0:f.unpack(),L=null===(y=null==w?void 0:w["mpris:length"])||void 0===y?void 0:y.unpack(),M=c(x);var I;(M||v)&&(null!=L&&N(L),null!=C&&function(t){if(100*t>100)return void(d.Volume=1);const n=Math.round(100*t);(function(t){const n=t/100*m.get_vol_max_norm();g&&g.volume!==n&&(g.is_muted&&g.change_is_muted(!1),g.volume=n,g.push_volume())})(n),o(n)}(C),P&&function(t){0!==b&&(n(t),"Paused"===t?U():E($()))}(P),x&&M&&x!==v&&(v=I=x,N(0),S&&U(),l(0),e(I)),k&&function(t){i(t)}(k))}))}function I(){x=d.connectSignal("Seeked",((t,n,e)=>{E(G(e))}))}function N(t){const e=G(t);a(e);const o=0!==t&&0===b;b=e,0===t&&n("Loading"),(o||k)&&(E(o?0:$()),n(Y()),k=!1)}function E(t){U(),l(t),D()}function D(){"Playing"===Y()&&(S=setInterval((()=>{const t=Math.min($(),b);l(t),t===b&&(n("Loading"),k=!0,U())}),1e3))}function U(){S&&(clearInterval(S),S=null)}function $(){return"Stopped"===Y()?0:G(p.GetSync("org.mpris.MediaPlayer2.Player","Position")[0].deep_unpack())}function R(t){j()!==t&&"Stopped"!==Y()&&(d.Volume=t/100)}function z(){if("Stopped"!==Y())return d.Metadata["xesam:title"].unpack()}function Y(){return u.ListNamesSync()[0].includes(y)?d.PlaybackStatus:"Stopped"}function j(){return"Stopped"===Y()?null:Math.round(100*d.Volume)}function G(t){const n=t/1e6;return Math.round(n)}return{increaseDecreaseVolume:function(t){R(Math.min(100,Math.max(0,j()+t)))},setVolume:R,setUrl:function(t){if("Stopped"!==Y())d.OpenUriRemote(t),d.PlaySync();else{const n=s();if(null==n)throw new Error("initial Volume must not be undefined or null");A(`mpv --script=${_} ${t} \n                --volume=${n}`)}},togglePlayPause:function(){"Stopped"!==Y()&&d.PlayPauseSync()},stop:function(){"Stopped"!==Y()&&d.StopSync()},getCurrentTitle:z,setPosition:function(t){const n=Math.min(1e6*t,1e6*b),e=d.Metadata["mpris:trackid"].unpack();null==d||d.SetPositionRemote(e,n)},deactivateAllListener:function(){u.disconnectSignal(L),P&&(null==p||p.disconnectSignal(P)),x&&(null==d||d.disconnectSignal(x))},dbus:u}}({getInitialVolume:()=>P.initialVolume,onVolumeChanged:W,onLengthChanged:function(t){j.setLength(t)},onPositionChanged:function(t){null==j||j.setPosition(t)},checkUrlValid:t=>x.checkUrlValid(t),onTitleChanged:function(t){E.setSongTitle(t)},onPlaybackstatusChanged:function(t){"Stopped"===t&&(G.hide(),P.lastVolume=l,P.lastUrl=null,m.setText(null),W(null),N.close()),"Stopped"===t||G.visible||G.show(),k.setPlaybackStatus(t),p.setPlaybackStatus(t),("Playing"===t||"Paused"===t)&&D.setPlaybackStatus(t)},lastUrl:P.lastUrl,onUrlChanged:function(t){const n=t?x.getChannelName(t):null;m.setText(n),k.setCurrentChannel(n),E.setChannel(n),P.lastUrl=t}}),g}radioApplet=n})();